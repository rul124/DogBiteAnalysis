[["results.html", "Chapter 5 Results", " Chapter 5 Results Process data read doge bite data csv and other supplement data DogBiteDF &lt;- read_csv(&quot;DOHMH_Dog_Bite_Data.csv&quot;, na = c(&quot;&quot;, &quot;NA&quot;,&quot;?&quot;)) Temperature &lt;- read_csv(&quot;tempbymonth.csv&quot;, na = c(&quot;&quot;, &quot;NA&quot;)) DogRegDF &lt;- read_csv(&quot;NYC_Dog_Licensing_Dataset.csv&quot;) data clean DateOfBite: Extract the Year and Month from the column ‘DateofBite’ ii: Breed There are numerous data with empty breed, so let’s set them as unknown iii: Age Several age records are string not numeric. Covert age in months to age in years. iv: Reshape the temperature data frame v: DogBite dataframe left join temperature. Temperature &lt;- Temperature %&gt;% pivot_longer(!Year, names_to = &quot;Month&quot;, names_transform = list(Month = as.integer), values_to = &quot;Avg_temp&quot;, values_drop_na = TRUE) DogBiteDF &lt;- DogBiteDF %&gt;% left_join(., Temperature, by=c(&#39;MonthOfBite&#39;=&#39;Month&#39;, &#39;YearOfBite&#39;=&#39;Year&#39;), suffix = c(&quot;_x&quot;, &quot;_y&quot;)) Draw graphs The distribution of bite record on borough and years data_for_draw &lt;- DogBiteDF %&gt;% group_by(YearOfBite, Borough) %&gt;% count(name=&#39;value&#39;) %&gt;% arrange(YearOfBite, value) # Set a number of &#39;empty bar&#39; to add at the end of each group empty_bar &lt;- 1 to_add &lt;- data.frame(matrix(NA, empty_bar*nlevels(as.factor(data_for_draw$YearOfBite)), ncol(data_for_draw))) colnames(to_add) &lt;- colnames(data_for_draw) to_add$YearOfBite &lt;- rep(as.numeric(levels(as.factor(data_for_draw$YearOfBite))), each=empty_bar) data_for_draw &lt;- rbind(data_for_draw, to_add) data_for_draw &lt;- data_for_draw %&gt;% arrange(YearOfBite) data_for_draw$id &lt;- seq(1, nrow(data_for_draw)) # Get the name and the y position of each label label_biteDF &lt;- data_for_draw number_of_bar &lt;- nrow(label_biteDF) angle &lt;- 90 - 360 * (label_biteDF$id-0.5) /number_of_bar label_biteDF$hjust &lt;- ifelse(angle &lt; -90, 1, 0) label_biteDF$angle &lt;- ifelse(angle &lt; -90, angle+180, angle) # prepare a data frame for base lines baselines_DF &lt;- data_for_draw %&gt;% group_by(YearOfBite) %&gt;% summarize(start=min(id), end=max(id) - empty_bar) %&gt;% rowwise() %&gt;% mutate(title=mean(c(start, end))) # prepare a data frame for grid (scales) grid_data &lt;- baselines_DF grid_data$end &lt;- grid_data$end[c( nrow(grid_data), 1:nrow(grid_data)-1)] + 1 grid_data$start &lt;- grid_data$start - 1 grid_data &lt;- grid_data[-1,] # Make the plot graph1 &lt;- ggplot(data_for_draw, aes(x=as.factor(id), y=value, fill=as.factor(YearOfBite))) + geom_bar(stat=&quot;identity&quot;, alpha=0.5) + annotate(&quot;text&quot;, x = rep(max(data_for_draw$id),4), y = c(200, 400, 600, 800), label = c(&quot;200&quot;, &quot;400&quot;, &quot;600&quot;, &quot;800&quot;) , color=&quot;grey&quot;, size=2 , angle=0, fontface=&quot;bold&quot;, vjust=0.5) + ylim(-500,900) + theme_minimal() + theme( legend.position = &quot;none&quot;, axis.text = element_blank(), axis.title = element_blank(), panel.grid = element_blank(), plot.margin = unit(rep(-1,4), &quot;cm&quot;) ) + coord_polar() + geom_text(data=label_biteDF, aes(x=id, y=value+10, label=Borough, hjust=hjust), color=&quot;black&quot;, fontface=&quot;bold&quot;,alpha=0.6, size=2.5, angle= label_biteDF$angle, inherit.aes = FALSE ) + # Add base line information geom_segment(data=baselines_DF, aes(x = start, y = -50, xend = end, yend = -51), colour = &quot;black&quot;, alpha=0.8, size=0.6 , inherit.aes = FALSE ) + geom_text(data=baselines_DF, aes(x = title, y = -150, label=YearOfBite), vjust=1, colour = &quot;black&quot;, alpha=0.8, size=2, fontface=&quot;bold&quot;, inherit.aes = FALSE) + scale_color_brewer(palette = &quot;RdYlBu&quot;) graph1 The distribution of bite record with the time. data_for_draw_1 &lt;- DogBiteDF %&gt;% group_by(MonthOfBite, Borough) %&gt;% count(name=&#39;value&#39;) %&gt;% arrange(Borough, MonthOfBite) data_for_draw_1$Borough &lt;- as.factor(data_for_draw_1$Borough) %&gt;% fct_reorder(., data_for_draw_1$value, min, .desc = TRUE) graph2 &lt;- ggplot(data_for_draw_1, aes(x=as.factor(MonthOfBite), y=value, fill=as.factor(Borough))) + geom_bar(stat = &quot;identity&quot;, width=0.8) + facet_wrap(~ Borough, ncol = 2) + theme_minimal() + theme(legend.position = &quot;none&quot;) + labs(title=&quot;Bite records count by month&quot;, x =&quot;Month&quot;, y = &quot;Numbers&quot;) + scale_color_brewer(palette = &quot;RdYlBu&quot;) graph2 iii: The distribution of bite record with month average temperature. data_for_draw_2 &lt;- DogBiteDF %&gt;% group_by(Avg_temp, Borough) %&gt;% count(name=&#39;value&#39;) %&gt;% arrange(Borough, Avg_temp) data_for_draw_2$Borough &lt;- as.factor(data_for_draw_2$Borough) %&gt;% fct_reorder(., data_for_draw_2$value, min, .desc = TRUE) graph3 &lt;- ggplot(data_for_draw_2, aes(x=Avg_temp, y=value, color=as.factor(Borough))) + geom_point() + geom_smooth(method = &quot;loess&quot;) + facet_wrap(~ Borough, ncol = 2, scales=&#39;free_y&#39;) + theme_minimal() + theme(legend.position = &quot;none&quot;) + labs(title=&quot;Bite records count by Monthly Average Temperature&quot;, x =&quot;Temperature(F)&quot;, y = &quot;Numbers&quot;) + scale_color_brewer(palette = &quot;RdYlBu&quot;) graph3 iv: The distribution of bite record with breed, age, gender and neuter or not. p_load(scales) data_for_draw_3 &lt;- DogBiteDF %&gt;% group_by(Breed) %&gt;% count(name=&#39;value&#39;) %&gt;% arrange(desc(value)) data_for_draw_3$Breed &lt;- as.factor(data_for_draw_3$Breed) %&gt;% fct_reorder(., data_for_draw_3$value, min, .desc = TRUE) data_for_draw_3$fraction &lt;- data_for_draw_3$value / sum(data_for_draw_3$value) data_for_draw_3$ymax &lt;- cumsum(data_for_draw_3$fraction) data_for_draw_3$ymin &lt;- c(0, head(data_for_draw_3$ymax, n=-1)) data_for_draw_3$labelPosition &lt;- (data_for_draw_3$ymax + data_for_draw_3$ymin) / 2 # Compute a good label data_for_draw_3$label &lt;- paste0(data_for_draw_3$Breed, &quot;:\\n &quot;, data_for_draw_3$value) data_for_draw_3 &lt;- data_for_draw_3 %&gt;% head(9) # Make the plot graph4 &lt;- ggplot(data_for_draw_3, aes(ymax=ymax, ymin=ymin, xmax=3, xmin=2, fill=Breed)) + geom_rect() + geom_text(x=3.5, aes(y=labelPosition, label=percent(fraction,accuracy=0.01)), size=3, inherit.aes = FALSE) + scale_fill_brewer(palette=&quot;RdYlBu&quot;) + # scale_color_brewer(palette=&quot;RdYlBu&quot;) + coord_polar(theta=&quot;y&quot;) + xlim(c(0, 3)) + theme_void() + labs(title=&quot;Bite records count by Breed (Top 9)&quot;) data_for_draw_3 &lt;- DogRegDF %&gt;% rename(., Breed = BreedName) %&gt;% mutate(Breed = replace_na(Breed, &#39;UNKNOWN&#39;)) %&gt;% group_by(Breed) %&gt;% count(name=&#39;value&#39;) %&gt;% arrange(desc(value)) data_for_draw_3$Breed &lt;- as.factor(data_for_draw_3$Breed) %&gt;% fct_reorder(., data_for_draw_3$value, min, .desc = TRUE) data_for_draw_3$fraction &lt;- data_for_draw_3$value / sum(data_for_draw_3$value) data_for_draw_3$ymax &lt;- cumsum(data_for_draw_3$fraction) data_for_draw_3$ymin &lt;- c(0, head(data_for_draw_3$ymax, n=-1)) data_for_draw_3$labelPosition &lt;- (data_for_draw_3$ymax + data_for_draw_3$ymin) / 2 # Compute a good label data_for_draw_3$label &lt;- paste0(data_for_draw_3$Breed, &quot;:\\n &quot;, data_for_draw_3$value) data_for_draw_3 &lt;- data_for_draw_3 %&gt;% head(9) # Make the plot graph5 &lt;- ggplot(data_for_draw_3, aes(ymax=ymax, ymin=ymin, xmax=3, xmin=2, fill=Breed)) + geom_rect() + geom_text(x=3.5, aes(y=labelPosition, label=percent(fraction,accuracy=0.01)), size=3, inherit.aes = FALSE) + scale_fill_brewer(palette=&quot;RdYlBu&quot;) + # scale_color_brewer(palette=&quot;RdYlBu&quot;) + coord_polar(theta=&quot;y&quot;) + xlim(c(0, 3)) + theme_void() + labs(title=&quot;NYC Dog Registered Number on Breed (Top 9)&quot;) graph4 graph5 p_load(ggridges) data_for_draw_4 &lt;- DogBiteDF %&gt;% filter(Age&lt;25 &amp; Age &gt; 0) # group_by(Age, Borough) %&gt;% # count(name=&#39;value&#39;) %&gt;% # arrange(Borough, Age) data_for_draw_4$Borough &lt;- as.factor(data_for_draw_4$Borough) graph5 &lt;- data_for_draw_4 %&gt;% ggplot(aes(y=Borough, x=Age, fill=Borough)) + geom_density_ridges(alpha=0.6, stat=&quot;binline&quot;, bins=22, scale=0.9) + theme_ridges() + theme( legend.position=&quot;none&quot;, panel.spacing = unit(0.5, &quot;lines&quot;), ) + labs(title=&quot;Bite records count by Age&quot;, x =&quot;Age (Year)&quot;, y = &quot;Numbers&quot;) graph5 data_for_draw_5 &lt;- DogBiteDF %&gt;% group_by(Gender, SpayNeuter) %&gt;% count(name = &#39;Number&#39;) %&gt;% ungroup() graph6 &lt;- ggplot(data_for_draw_5, aes(Gender, SpayNeuter, fill= Number)) + geom_tile() + geom_text(aes(label = Number)) + scale_fill_gradient(low=&quot;orange&quot;, high=&quot;red&quot;) + theme_minimal() graph6 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
